(()=>{"use strict";class e{constructor(e={}){this.options={rootMargin:"50px 0px",threshold:.01,imageSelector:"img[data-src], img[data-lazy], img.lazy",backgroundSelector:"[data-bg-src]",videoSelector:"video[data-src]",iframeSelector:"iframe[data-src]",loadedClass:"lazy-loaded",loadingClass:"lazy-loading",errorClass:"lazy-error",fadeInDuration:300,retryAttempts:3,retryDelay:1e3,enableWebP:!0,enablePlaceholders:!0,enableNativeLazyLoading:!0,...e},this.observer=null,this.retryCount=new Map,this.loadedItems=new Set,this.webPSupported=!1,this.init()}init(){this.checkWebPSupport(),this.setupProgressiveEnhancement(),this.initializeLazyLoading()}checkWebPSupport(){if(!this.options.enableWebP)return void(this.webPSupported=!1);const e=document.createElement("canvas");e.width=1,e.height=1,this.webPSupported=0===e.toDataURL("image/webp").indexOf("image/webp"),document.documentElement.classList.add(this.webPSupported?"webp-supported":"no-webp")}setupProgressiveEnhancement(){document.documentElement.classList.add("js-lazy-load"),this.addLoadingStyles(),this.options.enablePlaceholders&&this.setupPlaceholders()}addLoadingStyles(){const e=document.createElement("style");e.textContent=`\n      .js-lazy-load img.lazy-loading {\n        opacity: 0;\n        transition: opacity ${this.options.fadeInDuration}ms ease-in-out;\n      }\n      \n      .js-lazy-load img.lazy-loaded {\n        opacity: 1;\n      }\n      \n      .js-lazy-load img.lazy-error {\n        opacity: 0.5;\n        filter: grayscale(100%);\n      }\n      \n      .js-lazy-load .lazy-placeholder {\n        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n        background-size: 200% 100%;\n        animation: loading-shimmer 1.5s infinite;\n      }\n      \n      @keyframes loading-shimmer {\n        0% { background-position: 200% 0; }\n        100% { background-position: -200% 0; }\n      }\n      \n      .js-lazy-load .lazy-placeholder.loaded {\n        animation: none;\n        background: none;\n      }\n      \n      /* Network-aware optimizations */\n      .slow-connection .lazy-placeholder {\n        animation-duration: 3s;\n      }\n      \n      .save-data img[data-src] {\n        background: #f0f0f0;\n      }\n    `,document.head.appendChild(e)}setupPlaceholders(){document.querySelectorAll(this.options.imageSelector).forEach(e=>{!e.src&&e.dataset.src&&(e.classList.add("lazy-placeholder"),e.dataset.placeholder?e.src=e.dataset.placeholder:this.generatePlaceholder(e))})}generatePlaceholder(e){const t=e.getAttribute("width")||400,a=e.getAttribute("height")||300,s=`data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${a}' viewBox='0 0 ${t} ${a}'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E`;e.src=s}initializeLazyLoading(){this.options.enableNativeLazyLoading&&"loading"in HTMLImageElement.prototype?this.initNativeLazyLoading():"IntersectionObserver"in window?this.initIntersectionObserver():this.initScrollBasedLazyLoading()}initNativeLazyLoading(){document.querySelectorAll(this.options.imageSelector).forEach(e=>{e.dataset.src&&(e.src=this.getOptimalImageSource(e),e.loading="lazy",e.classList.add(this.options.loadedClass),this.handleImageLoad(e))}),this.initIntersectionObserver()}initIntersectionObserver(){this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadElement(e.target),this.observer.unobserve(e.target))})},{rootMargin:this.options.rootMargin,threshold:this.options.threshold}),this.observeElements()}observeElements(){document.querySelectorAll(`\n      ${this.options.imageSelector},\n      ${this.options.backgroundSelector},\n      ${this.options.videoSelector},\n      ${this.options.iframeSelector}\n    `).forEach(e=>{this.loadedItems.has(e)||this.observer.observe(e)})}initScrollBasedLazyLoading(){const e=document.querySelectorAll(`\n      ${this.options.imageSelector},\n      ${this.options.backgroundSelector},\n      ${this.options.videoSelector},\n      ${this.options.iframeSelector}\n    `),t=()=>{e.forEach(e=>{!this.loadedItems.has(e)&&this.isInViewport(e)&&this.loadElement(e)})};let a=!1;const s=()=>{a||(requestAnimationFrame(()=>{t(),a=!1}),a=!0)};t(),window.addEventListener("scroll",s,{passive:!0}),window.addEventListener("resize",s,{passive:!0}),window.addEventListener("orientationchange",s,{passive:!0})}isInViewport(e){const t=e.getBoundingClientRect(),a=parseInt(this.options.rootMargin);return t.top<=window.innerHeight+a&&t.bottom>=-a&&t.left<=window.innerWidth+a&&t.right>=-a}async loadElement(e){if(!this.loadedItems.has(e)){this.loadedItems.add(e),e.classList.add(this.options.loadingClass);try{"IMG"===e.tagName?await this.loadImage(e):"VIDEO"===e.tagName?await this.loadVideo(e):"IFRAME"===e.tagName?await this.loadIframe(e):e.dataset.bgSrc&&await this.loadBackgroundImage(e),e.classList.remove(this.options.loadingClass),e.classList.add(this.options.loadedClass),e.dispatchEvent(new CustomEvent("lazyloaded",{detail:{element:e}}))}catch(t){this.handleLoadError(e,t)}}}loadImage(e){return new Promise((t,a)=>{const s=new Image;s.onload=()=>{const a=this.getOptimalImageSource(e);e.src=a,e.dataset.srcset&&(e.srcset=e.dataset.srcset),e.dataset.sizes&&(e.sizes=e.dataset.sizes),this.handleImageLoad(e),t()},s.onerror=()=>{a(new Error(`Failed to load image: ${e.dataset.src}`))},s.src=this.getOptimalImageSource(e)})}getOptimalImageSource(e){const t=e.dataset.src;return this.webPSupported&&e.dataset.webp?e.dataset.webp:!this.webPSupported&&e.dataset.fallback?e.dataset.fallback:t}handleImageLoad(e){e.classList.remove("lazy-placeholder"),e.style.background="",this.options.fadeInDuration>0&&(e.style.transition=`opacity ${this.options.fadeInDuration}ms ease-in-out`)}loadVideo(e){return new Promise((t,a)=>{e.dataset.src&&(e.src=e.dataset.src),e.querySelectorAll("source[data-src]").forEach(e=>{e.src=e.dataset.src,e.removeAttribute("data-src")}),e.load(),e.addEventListener("loadeddata",()=>t(),{once:!0}),e.addEventListener("error",()=>a(new Error("Video load failed")),{once:!0})})}loadIframe(e){return new Promise((t,a)=>{e.onload=()=>t(),e.onerror=()=>a(new Error("Iframe load failed")),e.src=e.dataset.src})}loadBackgroundImage(e){return new Promise((t,a)=>{const s=new Image;s.onload=()=>{const a=this.webPSupported&&e.dataset.bgWebp?e.dataset.bgWebp:e.dataset.bgSrc;e.style.backgroundImage=`url(${a})`,e.classList.add("bg-loaded"),t()},s.onerror=()=>{a(new Error(`Failed to load background image: ${e.dataset.bgSrc}`))},s.src=e.dataset.bgSrc})}handleLoadError(e,t){e.classList.remove(this.options.loadingClass),e.classList.add(this.options.errorClass);const a=this.retryCount.get(e)||0;a<this.options.retryAttempts?(this.retryCount.set(e,a+1),setTimeout(()=>{this.loadedItems.delete(e),e.classList.remove(this.options.errorClass),this.loadElement(e)},this.options.retryDelay*(a+1))):("IMG"===e.tagName&&e.dataset.fallback&&(e.src=e.dataset.fallback,e.classList.remove(this.options.errorClass),e.classList.add(this.options.loadedClass)),e.dispatchEvent(new CustomEvent("lazyloaderror",{detail:{element:e,error:t}})))}loadAll(){document.querySelectorAll(`\n      ${this.options.imageSelector}:not(.${this.options.loadedClass}),\n      ${this.options.backgroundSelector}:not(.${this.options.loadedClass}),\n      ${this.options.videoSelector}:not(.${this.options.loadedClass}),\n      ${this.options.iframeSelector}:not(.${this.options.loadedClass})\n    `).forEach(e=>this.loadElement(e))}update(){this.observer&&this.observeElements()}destroy(){this.observer&&this.observer.disconnect(),this.retryCount.clear(),this.loadedItems.clear(),document.documentElement.classList.remove("js-lazy-load")}static init(t={}){return new e(t)}}"undefined"==typeof window||window.moduleSystem||document.addEventListener("DOMContentLoaded",()=>{e.init()})})();
//# sourceMappingURL=lazy-load.21fbbe1b.js.map