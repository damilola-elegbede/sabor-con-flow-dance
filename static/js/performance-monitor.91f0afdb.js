(()=>{"use strict";class e{constructor(e={}){this.options={enableWebVitals:!0,enableCustomMetrics:!0,enableNavigationTiming:!0,enableResourceTiming:!0,enableUserTiming:!0,sampleRate:1,bufferSize:100,sendInterval:3e4,endpoint:"/api/performance",...e},this.metrics=new Map,this.buffer=[],this.observers=new Map,this.startTime=performance.now(),this.init()}init(){Math.random()>this.options.sampleRate||(this.setupWebVitals(),this.setupCustomMetrics(),this.setupNavigationTiming(),this.setupResourceTiming(),this.setupUserTiming(),this.setupSendInterval())}setupWebVitals(){this.options.enableWebVitals&&(this.trackCLS(),this.trackFID(),this.trackLCP(),this.trackFCP(),this.trackTTFB())}trackCLS(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())t.hadRecentInput||this.recordMetric("CLS",{value:t.value,sources:t.sources?.map(e=>({element:e.node?.tagName||"unknown",previousRect:e.previousRect,currentRect:e.currentRect}))||[]})});e.observe({entryTypes:["layout-shift"]}),this.observers.set("cls",e)}catch(e){}}trackFID(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())this.recordMetric("FID",{value:t.processingStart-t.startTime,startTime:t.startTime,processingStart:t.processingStart,processingEnd:t.processingEnd})});e.observe({entryTypes:["first-input"]}),this.observers.set("fid",e)}catch(e){}}trackLCP(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),r=t[t.length-1];this.recordMetric("LCP",{value:r.startTime,element:r.element?.tagName||"unknown",url:r.url||"",size:r.size||0})});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.set("lcp",e)}catch(e){}}trackFCP(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())"first-contentful-paint"===t.name&&this.recordMetric("FCP",{value:t.startTime})});e.observe({entryTypes:["paint"]}),this.observers.set("fcp",e)}catch(e){}}trackTTFB(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())this.recordMetric("TTFB",{value:t.responseStart-t.requestStart,dns:t.domainLookupEnd-t.domainLookupStart,tcp:t.connectEnd-t.connectStart,request:t.responseStart-t.requestStart,response:t.responseEnd-t.responseStart})});e.observe({entryTypes:["navigation"]}),this.observers.set("navigation",e)}catch(e){}}setupCustomMetrics(){this.options.enableCustomMetrics&&(this.trackBundleLoadTimes(),this.trackCriticalResources(),this.trackUserInteractions(),this.trackMemoryUsage())}trackBundleLoadTimes(){performance.mark("bundle-start"),window.addEventListener("load",()=>{performance.mark("bundle-end");const e=performance.measure("bundle-load","bundle-start","bundle-end");this.recordMetric("Bundle Load Time",{value:e.duration,bundles:this.getLoadedBundles()})})}getLoadedBundles(){return Array.from(document.querySelectorAll("script[src]")).map(e=>({src:e.src,async:e.async,defer:e.defer}))}trackCriticalResources(){const e=document.querySelector(".hero img, .hero video");if(e){const t=performance.now(),r=()=>{const r=performance.now()-t;this.recordMetric("Hero Media Load",{value:r,type:e.tagName.toLowerCase(),src:e.src||e.currentSrc})};e.complete||e.readyState>=2?r():(e.addEventListener("load",r),e.addEventListener("loadeddata",r))}"fonts"in document&&document.fonts.ready.then(()=>{this.recordMetric("Fonts Loaded",{value:performance.now()-this.startTime,count:document.fonts.size})})}trackUserInteractions(){let e=null;const t=["click","touchstart","keydown","scroll"],r=n=>{e||(e=performance.now(),this.recordMetric("Time to First Interaction",{value:e-this.startTime,type:n.type}),t.forEach(e=>{document.removeEventListener(e,r)}))};t.forEach(e=>{document.addEventListener(e,r,{passive:!0,once:!0})}),this.trackScrollDepth()}trackScrollDepth(){let e=0,t=null;window.addEventListener("scroll",()=>{const r=window.pageYOffset,n=document.documentElement.scrollHeight-window.innerHeight,s=Math.round(r/n*100);s>e&&(e=s),clearTimeout(t),t=setTimeout(()=>{this.recordMetric("Scroll Depth",{value:e,timestamp:performance.now()})},500)},{passive:!0}),window.addEventListener("beforeunload",()=>{this.recordMetric("Final Scroll Depth",{value:e})})}trackMemoryUsage(){if("memory"in performance){const e=()=>{this.recordMetric("Memory Usage",{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit})};e(),setInterval(e,6e4)}}setupNavigationTiming(){this.options.enableNavigationTiming&&window.addEventListener("load",()=>{const e=performance.getEntriesByType("navigation")[0];e&&this.recordMetric("Navigation Timing",{dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.requestStart,download:e.responseEnd-e.responseStart,domParsing:e.domContentLoadedEventStart-e.responseEnd,resourceLoading:e.loadEventStart-e.domContentLoadedEventStart})})}setupResourceTiming(){if(!this.options.enableResourceTiming)return;const e=()=>{const e=performance.getEntriesByType("resource").filter(e=>e.duration>1e3);e.length>0&&this.recordMetric("Slow Resources",{count:e.length,resources:e.map(e=>({name:e.name,duration:e.duration,size:e.transferSize,type:e.initiatorType}))})};window.addEventListener("load",()=>{setTimeout(e,1e3)})}setupUserTiming(){if(!this.options.enableUserTiming)return;const e=()=>{const e=performance.getEntriesByType("mark"),t=performance.getEntriesByType("measure");(e.length>0||t.length>0)&&this.recordMetric("User Timing",{marks:e.map(e=>({name:e.name,startTime:e.startTime})),measures:t.map(e=>({name:e.name,duration:e.duration,startTime:e.startTime}))})};window.addEventListener("load",()=>{setTimeout(e,2e3)})}recordMetric(e,t){const r={name:e,data:t,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,connection:this.getConnectionInfo()};this.metrics.set(e,r),this.buffer.push(r),this.isCriticalMetric(e)&&this.sendMetrics([r])}getConnectionInfo(){if("connection"in navigator){const e=navigator.connection;return{effectiveType:e.effectiveType,downlink:e.downlink,rtt:e.rtt,saveData:e.saveData}}return null}isCriticalMetric(e){return["CLS","FID","LCP"].includes(e)}setupSendInterval(){setInterval(()=>{this.buffer.length>0&&this.sendBufferedMetrics()},this.options.sendInterval),window.addEventListener("beforeunload",()=>{this.sendBufferedMetrics(!0)}),this.checkBufferSize()}checkBufferSize(){this.buffer.length>=this.options.bufferSize&&this.sendBufferedMetrics()}sendBufferedMetrics(e=!1){if(0===this.buffer.length)return;const t=[...this.buffer];this.buffer=[],this.sendMetrics(t,e)}async sendMetrics(e,t=!1){const r={metrics:e,session:this.getSessionId(),page:{url:window.location.href,title:document.title,referrer:document.referrer},timestamp:Date.now()};try{t&&"sendBeacon"in navigator?navigator.sendBeacon(this.options.endpoint,JSON.stringify(r)):(this.sendToAnalytics(e),this.options.endpoint&&await fetch(this.options.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}))}catch(n){}}sendToAnalytics(e){window.gtag&&e.forEach(e=>{void 0!==e.data.value&&window.gtag("event","web_vitals",{name:e.name,value:Math.round(e.data.value),metric_id:this.generateMetricId(e),custom_parameters:e.data})})}generateMetricId(e){return`${e.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getSessionId(){return this.sessionId||(this.sessionId=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`),this.sessionId}trackCustomEvent(e,t={}){this.recordMetric(`Custom: ${e}`,t)}mark(e){performance.mark(e)}measure(e,t,r){const n=performance.measure(e,t,r);return this.recordMetric(`Measure: ${e}`,{value:n.duration,startTime:n.startTime}),n}getMetrics(){return Object.fromEntries(this.metrics)}start(){this.init()}stop(){this.observers.forEach(e=>e.disconnect()),this.observers.clear(),this.sendBufferedMetrics()}static init(t={}){return new e(t)}}"undefined"==typeof window||window.moduleSystem||document.addEventListener("DOMContentLoaded",()=>{e.init()})})();
//# sourceMappingURL=performance-monitor.91f0afdb.js.map