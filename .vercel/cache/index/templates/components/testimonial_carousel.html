{% load static %}
<!-- Testimonial Carousel Component -->
<style>
    /* Carousel Container */
    .testimonial-carousel-section {
        background: linear-gradient(135deg, var(--color-gray-lighter) 0%, var(--color-white) 100%);
        padding: var(--spacing-3xl) 0;
        overflow: hidden;
    }
    
    .carousel-header {
        text-align: center;
        margin-bottom: var(--spacing-2xl);
    }
    
    .carousel-header h2 {
        color: var(--color-black);
        margin-bottom: var(--spacing-md);
    }
    
    .carousel-subtitle {
        color: var(--color-gray-medium);
        font-size: 1.125rem;
    }
    
    /* Carousel Wrapper */
    .testimonial-carousel-wrapper {
        position: relative;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 var(--spacing-md);
    }
    
    /* Carousel Container */
    .testimonial-carousel {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
    }
    
    /* Carousel Track */
    .carousel-track {
        display: flex;
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
    }
    
    /* Carousel Slide */
    .carousel-slide {
        flex: 0 0 100%;
        padding: 0 var(--spacing-md);
    }
    
    /* Testimonial Card for Carousel */
    .carousel-testimonial-card {
        background: var(--color-white);
        border-radius: 12px;
        padding: var(--spacing-2xl);
        box-shadow: var(--shadow-lg);
        text-align: center;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    /* Quote Icon */
    .carousel-quote-icon {
        font-size: 3rem;
        color: var(--color-gold);
        margin-bottom: var(--spacing-lg);
        opacity: 0.3;
    }
    
    /* Rating Stars */
    .carousel-rating {
        color: var(--color-gold);
        font-size: 1.25rem;
        margin-bottom: var(--spacing-lg);
    }
    
    /* Review Text */
    .carousel-review {
        font-size: 1.125rem;
        line-height: 1.8;
        color: var(--color-gray-dark);
        font-style: italic;
        margin-bottom: var(--spacing-xl);
        max-width: 800px;
        position: relative;
    }
    
    .carousel-review-text {
        display: inline;
    }
    
    /* Student Info */
    .carousel-student-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        justify-content: center;
    }
    
    .carousel-student-photo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--color-gold);
    }
    
    .carousel-student-photo-placeholder {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color-gold-light) 0%, var(--color-gold) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-white);
        font-weight: 700;
        font-size: 1.25rem;
    }
    
    .carousel-student-details {
        text-align: left;
    }
    
    .carousel-student-name {
        font-weight: 700;
        color: var(--color-black);
        margin-bottom: var(--spacing-xs);
    }
    
    .carousel-class-badge {
        display: inline-block;
        background: var(--color-gold);
        color: var(--color-black);
        padding: 2px var(--spacing-sm);
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    /* Read More Link */
    .carousel-read-more {
        color: var(--color-gold);
        text-decoration: none;
        font-weight: 600;
        transition: color var(--transition-base);
        margin-left: var(--spacing-xs);
    }
    
    .carousel-read-more:hover {
        color: var(--color-gold-dark);
        text-decoration: underline;
    }
    
    /* Navigation Buttons */
    .carousel-nav-button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: var(--color-white);
        border: 2px solid var(--color-gold);
        color: var(--color-gold);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-base);
        z-index: 2;
        font-size: 1.25rem;
    }
    
    .carousel-nav-button:hover {
        background: var(--color-gold);
        color: var(--color-white);
        transform: translateY(-50%) scale(1.1);
    }
    
    .carousel-nav-button.prev {
        left: -24px;
    }
    
    .carousel-nav-button.next {
        right: -24px;
    }
    
    /* Dots Indicator */
    .carousel-dots {
        display: flex;
        justify-content: center;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-xl);
    }
    
    .carousel-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--color-gray-light);
        border: none;
        cursor: pointer;
        transition: all var(--transition-base);
    }
    
    .carousel-dot.active {
        background: var(--color-gold);
        transform: scale(1.3);
    }
    
    /* Desktop - Show 3 testimonials */
    @media (min-width: 768px) {
        .carousel-slide {
            flex: 0 0 33.333%;
        }
        
        .carousel-testimonial-card {
            padding: var(--spacing-xl);
        }
        
        .carousel-review {
            font-size: 1rem;
        }
    }
    
    /* Mobile - Show 1 testimonial */
    @media (max-width: 767px) {
        .carousel-nav-button {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
        
        .carousel-nav-button.prev {
            left: 10px;
        }
        
        .carousel-nav-button.next {
            right: 10px;
        }
        
        .testimonial-carousel-wrapper {
            padding: 0 var(--spacing-xl);
        }
    }
    
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
        .carousel-track {
            transition: none;
        }
    }
</style>

<section class="testimonial-carousel-section">
    <div class="carousel-header">
        <h2>What Our Students Say</h2>
        <p class="carousel-subtitle">Join our community of passionate dancers</p>
    </div>
    
    <div class="testimonial-carousel-wrapper">
        <div class="testimonial-carousel">
            <div class="carousel-track" id="carouselTrack">
                {% for testimonial in carousel_testimonials %}
                <div class="carousel-slide">
                    <div class="carousel-testimonial-card">
                        <div class="carousel-quote-icon">
                            <i class="fas fa-quote-left"></i>
                        </div>
                        
                        <div class="carousel-rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= testimonial.rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <div class="carousel-review">
                            <span class="carousel-review-text">
                                {% if testimonial.content|length > 150 %}
                                    {{ testimonial.content|slice:":150" }}...
                                    <a href="{% url 'core:testimonials' %}" class="carousel-read-more">Read more</a>
                                {% else %}
                                    {{ testimonial.content }}
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="carousel-student-info">
                            {% if testimonial.photo %}
                                <img src="{{ testimonial.photo.url }}" alt="{{ testimonial.student_name }}" class="carousel-student-photo">
                            {% else %}
                                <div class="carousel-student-photo-placeholder">
                                    {{ testimonial.student_name|first }}
                                </div>
                            {% endif %}
                            
                            <div class="carousel-student-details">
                                <div class="carousel-student-name">{{ testimonial.student_name }}</div>
                                <span class="carousel-class-badge">{{ testimonial.class_type }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Navigation Buttons -->
            <button class="carousel-nav-button prev" onclick="moveCarousel(-1)" aria-label="Previous testimonial">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="carousel-nav-button next" onclick="moveCarousel(1)" aria-label="Next testimonial">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Dots Indicator -->
        <div class="carousel-dots" id="carouselDots">
            {% for testimonial in carousel_testimonials %}
                <button class="carousel-dot {% if forloop.first %}active{% endif %}" 
                        onclick="goToSlide({{ forloop.counter0 }})"
                        aria-label="Go to testimonial {{ forloop.counter }}"></button>
            {% endfor %}
        </div>
    </div>
</section>

<script>
(function() {
    let currentSlide = 0;
    let autoplayInterval;
    let isHovered = false;
    
    const track = document.getElementById('carouselTrack');
    const dots = document.querySelectorAll('.carousel-dot');
    const slides = document.querySelectorAll('.carousel-slide');
    const totalSlides = slides.length;
    
    // Determine slides to show based on viewport
    function getSlidesToShow() {
        return window.innerWidth >= 768 ? 3 : 1;
    }
    
    function updateCarousel() {
        const slidesToShow = getSlidesToShow();
        const maxSlide = Math.max(0, totalSlides - slidesToShow);
        currentSlide = Math.min(currentSlide, maxSlide);
        
        const slideWidth = 100 / slidesToShow;
        const offset = -currentSlide * slideWidth;
        
        track.style.transform = `translateX(${offset}%)`;
        
        // Update dots
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
        });
    }
    
    window.moveCarousel = function(direction) {
        const slidesToShow = getSlidesToShow();
        const maxSlide = Math.max(0, totalSlides - slidesToShow);
        
        currentSlide += direction;
        
        if (currentSlide < 0) {
            currentSlide = maxSlide;
        } else if (currentSlide > maxSlide) {
            currentSlide = 0;
        }
        
        updateCarousel();
        resetAutoplay();
    };
    
    window.goToSlide = function(slideIndex) {
        currentSlide = slideIndex;
        updateCarousel();
        resetAutoplay();
    };
    
    // Autoplay functionality
    function startAutoplay() {
        if (!isHovered) {
            autoplayInterval = setInterval(() => {
                moveCarousel(1);
            }, 5000); // Change slide every 5 seconds
        }
    }
    
    function stopAutoplay() {
        clearInterval(autoplayInterval);
    }
    
    function resetAutoplay() {
        stopAutoplay();
        startAutoplay();
    }
    
    // Pause on hover
    const carousel = document.querySelector('.testimonial-carousel');
    
    carousel.addEventListener('mouseenter', () => {
        isHovered = true;
        stopAutoplay();
    });
    
    carousel.addEventListener('mouseleave', () => {
        isHovered = false;
        startAutoplay();
    });
    
    // Touch/swipe support for mobile
    let touchStartX = 0;
    let touchEndX = 0;
    
    carousel.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    });
    
    carousel.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    });
    
    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                moveCarousel(1); // Swipe left - next slide
            } else {
                moveCarousel(-1); // Swipe right - previous slide
            }
        }
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
            moveCarousel(-1);
        } else if (e.key === 'ArrowRight') {
            moveCarousel(1);
        }
    });
    
    // Handle resize
    window.addEventListener('resize', () => {
        updateCarousel();
    });
    
    // Initialize
    updateCarousel();
    startAutoplay();
})();
</script>