# SPEC 05: External Integrations
**Component:** Third-Party Service Integrations
**Priority:** P0/P1 - Critical/Important
**Parallel Execution:** Tasks 1-4 parallel, 5-7 parallel, 8-10 parallel

## High-Level Context
Integrate essential third-party services that enable core business functions: Calendly for booking, WhatsApp for community building, Facebook Events/Pastio.fun for event management, and Google Analytics for tracking. These integrations connect the website to existing business workflows and marketing channels.

## Mid-Level Objectives
- Embed Calendly for seamless private lesson booking
- Add WhatsApp click-to-chat for instant communication
- Display Facebook Events and Pastio.fun events
- Implement Google Analytics with custom events
- Set up Google Business Profile API connection
- Create social media links and feeds

## Implementation Notes
- Use official APIs and SDKs where available
- Implement proper error handling for external services
- Cache external data to prevent API limits
- Ensure GDPR compliance for tracking
- Mobile-optimize all embedded widgets
- Provide fallbacks for service failures

## Required Context
- API credentials for all services
- Calendly account with availability set
- WhatsApp Business number
- Facebook Page with events
- Google Analytics property ID
- Environment variables configured

## Beginning Context (Prerequisites)
### Available Files
- Base templates and pages from SPEC_02
- Environment variable configuration
- Static file structure established

### System State
- Basic pages functional
- Database configured
- Admin interface available
- Development environment running

## Ending Context (Deliverables)
### Files to Create/Modify
- `templates/components/calendly_widget.html` - Calendly embed
- `templates/components/whatsapp_button.html` - WhatsApp chat
- `templates/components/social_links.html` - Social media links
- `core/utils/facebook_events.py` - Facebook Events fetcher
- `core/utils/analytics.py` - Analytics helper
- `static/js/analytics.js` - GA4 event tracking
- `static/js/calendly.js` - Calendly customization
- `.env` - Updated with API keys

### System State
- Calendly booking functional
- WhatsApp chat button active
- Events displaying from external sources
- Analytics tracking conversions
- Social links connected

## Low-Level Tasks (Implementation Prompts)

### Task 1: Embed Calendly Widget
**Prompt**: "Create templates/components/calendly_widget.html with Calendly inline widget embed code. Customize with brand colors (background: #000000, text: #C7B375, button: #C7B375). Create static/js/calendly.js to handle widget initialization, set prefill data from URL parameters, and add event listeners for booking completion. Widget height should be responsive."

**Acceptance Criteria**:
- [ ] Calendly widget embedded
- [ ] Brand colors applied
- [ ] Prefill functionality working
- [ ] Responsive height adjustment
- [ ] Booking completion tracking

### Task 2: Implement WhatsApp Chat
**Prompt**: "Create templates/components/whatsapp_button.html with floating WhatsApp button in bottom-right corner. Use WhatsApp API link format with pre-filled message: 'Hi! I'm interested in Sabor con Flow dance classes.' Add pulse animation to draw attention. Button should hide on scroll up and show on scroll down."

**Acceptance Criteria**:
- [ ] Floating WhatsApp button
- [ ] Pre-filled message working
- [ ] Pulse animation effect
- [ ] Show/hide on scroll
- [ ] Mobile responsive positioning

### Task 3: Set Up Google Analytics
**Prompt**: "Add Google Analytics 4 tracking code to base.html with gtag.js. Create static/js/analytics.js with custom event tracking for: CTA clicks, form submissions, video plays, booking completions, and page scroll depth. Implement enhanced ecommerce for class bookings. Ensure GDPR compliance with cookie consent."

**Acceptance Criteria**:
- [ ] GA4 tracking code installed
- [ ] Custom events configured
- [ ] Enhanced ecommerce setup
- [ ] Cookie consent banner
- [ ] Debug mode for development

### Task 4: Create Social Media Links
**Prompt**: "Create templates/components/social_links.html with icon links to Instagram, Facebook, WhatsApp, and email. Use Font Awesome icons with brand colors on hover. Add 'Follow us' text on desktop, icons only on mobile. Include proper aria-labels for accessibility."

**Acceptance Criteria**:
- [ ] All social platform links
- [ ] Font Awesome icons styled
- [ ] Hover effects with brand colors
- [ ] Responsive text/icon display
- [ ] Accessibility labels

### Task 5: Fetch Facebook Events
**Prompt**: "Create core/utils/facebook_events.py with function to fetch upcoming events from Facebook Graph API. Get events from specified Facebook Page, filter for future events only, cache results for 6 hours, extract: name, date, time, description, cover photo. Handle API errors gracefully with logging."

**Acceptance Criteria**:
- [ ] Facebook Graph API integration
- [ ] Future events filtered
- [ ] 6-hour cache implementation
- [ ] All event data extracted
- [ ] Error handling with logs

### Task 6: Display Facebook Events
**Prompt**: "Create view to display Facebook events on the schedule page. Show next 5 upcoming events in cards with cover photo, event name, date/time, brief description, and 'Learn More' link to Facebook event. Add 'Special Events' section below regular schedule."

**Acceptance Criteria**:
- [ ] Events fetched and displayed
- [ ] Card layout with photos
- [ ] Date/time formatting
- [ ] Links to Facebook events
- [ ] Integrated with schedule page

### Task 7: Integrate Pastio.fun Events
**Prompt**: "Add Pastio.fun event widget or API integration to show events with RSVP capability. Embed Pastio widget with custom styling to match site design, or fetch events via API if available. Display RSVP count and allow inline RSVP without leaving site."

**Acceptance Criteria**:
- [ ] Pastio events displayed
- [ ] RSVP functionality working
- [ ] RSVP count visible
- [ ] Styling matches site
- [ ] Mobile responsive

### Task 8: Add Spotify Playlists
**Prompt**: "Embed Spotify playlists for each class type in the Resources section. Use Spotify embed API with compact view, custom height of 380px, and theme matching site colors if possible. Create playlist cards with class name, description, and embedded player."

**Acceptance Criteria**:
- [ ] Spotify embeds working
- [ ] Compact view layout
- [ ] Playlist cards styled
- [ ] Mobile responsive embeds
- [ ] Loading states handled

### Task 9: Implement Instagram Feed
**Prompt**: "Create Instagram feed display using Basic Display API or embedding service. Show latest 6 posts in grid layout, update every 12 hours via cron/scheduled task, display photo/video thumbnails with overlay on hover, and link to Instagram posts. Cache data to avoid rate limits."

**Acceptance Criteria**:
- [ ] Instagram posts fetched
- [ ] 6-post grid layout
- [ ] 12-hour update cycle
- [ ] Hover overlays working
- [ ] Caching implemented

### Task 10: Configure Email Integration
**Prompt**: "Set up email configuration for contact forms and notifications. Configure Django email backend with SMTP settings, create HTML email templates matching brand, implement contact form with fields: name, email, phone, message, interest. Send notifications to admin and auto-reply to sender."

**Acceptance Criteria**:
- [ ] SMTP configuration working
- [ ] HTML email templates
- [ ] Contact form functional
- [ ] Admin notifications sent
- [ ] Auto-reply working

### Task 11: Add Google Maps
**Prompt**: "Embed Google Maps on contact page showing studio location. Use Google Maps Embed API with custom marker, set appropriate zoom level for neighborhood view, add info window with studio name and address, style map with dark theme to match site, and ensure responsive sizing."

**Acceptance Criteria**:
- [ ] Map embedded successfully
- [ ] Custom marker placed
- [ ] Info window configured
- [ ] Dark theme applied
- [ ] Responsive on all devices

### Task 12: Create API Status Dashboard
**Prompt**: "Build admin page showing status of all API integrations. Display connection status for each service (Calendly, Facebook, Instagram, Google), show last successful sync time, display any error messages, add manual refresh buttons, and implement health check endpoint for monitoring."

**Acceptance Criteria**:
- [ ] Status dashboard in admin
- [ ] All services monitored
- [ ] Last sync times shown
- [ ] Manual refresh capability
- [ ] Health check endpoint

## Parallel Execution Groups

**Group A (Parallel):**
- Task 1: Calendly widget
- Task 2: WhatsApp chat
- Task 3: Google Analytics
- Task 4: Social links

**Group B (Parallel):**
- Task 5: Facebook Events fetch
- Task 6: Facebook Events display
- Task 7: Pastio.fun integration

**Group C (Parallel):**
- Task 8: Spotify playlists
- Task 9: Instagram feed
- Task 10: Email integration

**Group D (Sequential):**
- Task 11: Google Maps
- Task 12: API dashboard

## Success Metrics
- Calendly bookings increase by 50%
- WhatsApp inquiries > 10 per week
- Event attendance tracking improved
- Analytics providing actionable insights
- Social media followers increase 30%

## Risk Mitigation
- Cache all external data to prevent outages
- Provide manual fallbacks for API failures
- Monitor API rate limits and quotas
- Test integrations across different devices
- Document all API credentials securely