{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sabor Con Flow{% endblock %}</title>
    <!-- Favicon configuration - using optimized images -->
    <link rel="icon" type="image/webp" href="{% static 'images/optimized/logo-2.webp' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/optimized/logo-2-320w.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/optimized/logo-2-320w.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/optimized/logo-2-320w.png' %}">
    <link rel="manifest" href="{% static 'images/site.webmanifest' %}">
    <meta name="theme-color" content="#000000">
    <!-- End favicon configuration -->
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/main.css' %}" rel="stylesheet" type="text/css">
    <!-- Calendly badge widget begin -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <!-- Calendly badge widget end -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Skip to main content link for keyboard/screen reader users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="header">
        <div class="header-container">
            <a href="{% url 'core:home' %}" class="header-logo">
                <picture>
                    <source type="image/webp" srcset="{% static 'images/optimized/logo-2.webp' %}">
                    <img src="{% static 'images/optimized/logo-2-320w.png' %}"
                         alt="Sabor Con Flow - Home"
                         width="35"
                         height="35"
                         loading="eager">
                </picture>
            </a>
            <div class="header-tagline">
                Sabor in every step, flow in every move ðŸ’«
            </div>
            <button class="menu-toggle" aria-label="Toggle navigation" aria-controls="site-nav" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <nav id="site-nav" class="nav" aria-label="Main navigation" aria-hidden="true">
            <!-- Close button - visible only when menu is open -->
            <button class="nav-close" aria-label="Close navigation menu" type="button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <a href="{% url 'core:home' %}" {% if current_page == 'home' %}class="nav-link--active" aria-current="page"{% endif %}><span>Home</span></a>
            <a href="{% url 'core:events' %}" {% if current_page == 'events' %}class="nav-link--active" aria-current="page"{% endif %}><span>Events</span></a>
            <a href="{% url 'core:pricing' %}" {% if current_page == 'pricing' %}class="nav-link--active" aria-current="page"{% endif %}><span>Pricing</span></a>
            <a href="{% url 'core:private_lessons' %}" {% if current_page == 'private_lessons' %}class="nav-link--active" aria-current="page"{% endif %}><span>Private Lessons</span></a>
            <a href="{% url 'core:contact' %}" {% if current_page == 'contact' %}class="nav-link--active" aria-current="page"{% endif %}><span>Contact</span></a>
        </nav>
    </header>

    {% if request.resolver_match.url_name != 'home' %}
    <div class="hero-section">
        <picture>
            <source type="image/webp" srcset="{% static 'images/optimized/pasos-basicos-poster.webp' %}">
            <img src="{% static 'images/optimized/pasos-basicos-poster.jpg' %}"
                 alt="Pasos BÃ¡sicos - Cuban Dance Steps"
                 class="hero-image"
                 width="851"
                 height="315"
                 loading="eager"
                 decoding="async">
        </picture>
        <div class="hero-overlay"></div>
    </div>
    {% endif %}
    <main id="main-content" class="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer text-center py-4">
        <div class="container">
            <div class="social-links">
                <a href="https://www.instagram.com/saborconflow.dance/" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="Follow us on Instagram">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" aria-hidden="true">
                        <defs>
                            <linearGradient id="instaFooterGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#FEDA75"/><stop offset="25%" stop-color="#F58529"/><stop offset="50%" stop-color="#DD2A7B"/><stop offset="75%" stop-color="#833AB4"/><stop offset="100%" stop-color="#405DE6"/>
                            </linearGradient>
                        </defs>
                        <rect width="24" height="24" rx="6" ry="6" fill="url(#instaFooterGradient)"/>
                        <path fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
                              d="M12 16.14a4.14 4.14 0 100-8.28 4.14 4.14 0 000 8.28z"/>
                        <circle fill="#ffffff" cx="17.3" cy="6.7" r="1.1"/>
                        <rect x="3.5" y="3.5" width="17" height="17" rx="4" ry="4" fill="none" stroke="#ffffff" stroke-width="1.8"/>
                    </svg>
                </a>
                <a href="https://chat.whatsapp.com/GaZONDA1HgFG7C8djihJ1x" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="Join our WhatsApp community">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" aria-hidden="true">
                        <rect width="24" height="24" rx="6" ry="6" fill="#25D366"/>
                        <path fill="#ffffff" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3 0-7.8 3.5-7.8 7.8 0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4 1 3.7 1 4.3 0 7.8-3.5 7.8-7.8.1-2.1-.7-4-2.2-5.5zm-5.5 12c-1.2 0-2.3-.3-3.3-.9l-.2-.1-2.4.6.6-2.3-.2-.2c-.6-1-1-2.2-1-3.4 0-3.6 2.9-6.5 6.5-6.5 1.7 0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.3-6.5 6.3zm3.6-4.9c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1-.1.2-.5.6-.6.8-.1.1-.2.1-.4 0-.6-.3-1.3-.7-1.9-1.3-.8-.7-1.2-1.5-1.3-1.7-.1-.2 0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.1-.2.1-.3 0-.1 0-.2-.1-.3l-.6-1.4c-.1-.3-.3-.3-.4-.3h-.4c-.1 0-.3.1-.5.2-.2.1-.6.6-.6 1.4s.6 1.6.7 1.7c.1.1 1.3 2 3.2 2.8.4.2.8.3 1 .3.2.1.5.1.7.1.2 0 .6-.3.7-.5.1-.3.1-.5.1-.6-.1-.1-.2-.1-.4-.2z"/>
                    </svg>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61575502290591" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="Follow us on Facebook">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" aria-hidden="true">
                        <rect width="24" height="24" rx="6" ry="6" fill="#1877F2"/>
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="#ffffff"/>
                    </svg>
                </a>
            </div>
            <p class="mt-3">&copy; {% now "Y" %} Sabor Con Flow. All rights reserved.</p>
        </div>
    </footer>

    <!-- Live region for screen reader announcements -->
    <div id="nav-announcer" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <script>
        /**
         * Mobile Navigation Module
         * Handles menu toggle, close button, keyboard navigation, focus trap, and scroll effects
         */
        (function() {
            'use strict';

            // DOM Elements
            const menuToggle = document.querySelector('.menu-toggle');
            const nav = document.getElementById('site-nav');
            const navClose = document.querySelector('.nav-close');
            const header = document.querySelector('.header');
            const announcer = document.getElementById('nav-announcer');

            if (!menuToggle || !nav) return;

            // State
            let isOpen = false;
            let focusableElements = [];
            let firstFocusable = null;
            let lastFocusable = null;

            // Update focusable elements list
            function updateFocusableElements() {
                focusableElements = nav.querySelectorAll(
                    'button:not([disabled]), a[href], [tabindex]:not([tabindex="-1"])'
                );
                if (focusableElements.length > 0) {
                    firstFocusable = focusableElements[0];
                    lastFocusable = focusableElements[focusableElements.length - 1];
                }
            }

            // Announce to screen readers
            function announce(message) {
                if (announcer) {
                    announcer.textContent = '';
                    setTimeout(() => { announcer.textContent = message; }, 100);
                }
            }

            // Open menu
            function openMenu() {
                isOpen = true;
                nav.classList.add('active');
                menuToggle.classList.add('active');
                menuToggle.setAttribute('aria-expanded', 'true');
                nav.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                announce('Navigation menu opened');
                updateFocusableElements();

                // Focus close button after animation
                setTimeout(() => {
                    if (navClose) navClose.focus();
                }, 350);
            }

            // Close menu
            function closeMenu(returnFocus = true) {
                isOpen = false;
                nav.classList.remove('active');
                menuToggle.classList.remove('active');
                menuToggle.setAttribute('aria-expanded', 'false');
                nav.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';

                announce('Navigation menu closed');

                if (returnFocus) {
                    menuToggle.focus();
                }
            }

            // Toggle menu
            function toggleMenu() {
                if (isOpen) {
                    closeMenu();
                } else {
                    openMenu();
                }
            }

            // Handle Tab key for focus trap
            function handleTabKey(e) {
                if (!isOpen || !firstFocusable || !lastFocusable) return;

                if (e.shiftKey) {
                    if (document.activeElement === firstFocusable) {
                        e.preventDefault();
                        lastFocusable.focus();
                    }
                } else {
                    if (document.activeElement === lastFocusable) {
                        e.preventDefault();
                        firstFocusable.focus();
                    }
                }
            }

            // Event Listeners
            menuToggle.addEventListener('click', toggleMenu);

            if (navClose) {
                navClose.addEventListener('click', () => closeMenu(true));
            }

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (isOpen && !nav.contains(e.target) && !menuToggle.contains(e.target)) {
                    closeMenu(false);
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && isOpen) {
                    e.preventDefault();
                    closeMenu(true);
                }
                if (e.key === 'Tab' && isOpen) {
                    handleTabKey(e);
                }
            });

            // ==========================================================================
            // Header Scroll Blur Effect
            // ==========================================================================
            const SCROLL_THRESHOLD = 50;
            let ticking = false;
            let lastScrollY = 0;

            function updateHeaderScroll() {
                if (lastScrollY > SCROLL_THRESHOLD) {
                    header.classList.add('header--scrolled');
                } else {
                    header.classList.remove('header--scrolled');
                }
                ticking = false;
            }

            function onScroll() {
                lastScrollY = window.scrollY;
                if (!ticking) {
                    window.requestAnimationFrame(updateHeaderScroll);
                    ticking = true;
                }
            }

            if (header) {
                window.addEventListener('scroll', onScroll, { passive: true });
                // Check initial scroll position
                lastScrollY = window.scrollY;
                updateHeaderScroll();
            }
        })();
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html> 